function queueTabCheckAsPromise(tab, preQueue) {
  preQueue = preQueue || [];
  return new Promise(function(resolve) {
    // Add defensive check for gsTabQueue
    if (!gsTabQueue || typeof gsTabQueue.queueTabAsPromise !== 'function') {
      console.warn('gsTabQueue not available for queueTabCheckAsPromise');
      resolve();
      return;
    }
    gsUtils.log(tab.id, 'Queuing tab for check.');
    gsTabQueue
      .queueTabAsPromise(tab.id, QUEUE_ID, function() {
        checkTab(tab, preQueue);
      })
      .then(resolve);
  });
}
